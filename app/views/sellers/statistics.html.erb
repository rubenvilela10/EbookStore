<% content_for :title, "Statistics" %>

<div class="max-w-7xl mx-auto py-12 px-6">
    <div id="analytics">
        <div class="kpi-container">
            <div class="kpi">
                <h3>Total Ebooks</h3>
                <p><%= @ebooks_count %></p>
            </div>
            <div class="kpi">
                <h3>Total Views</h3>
                <p><%= @total_views %></p>
            </div>
            <div class="kpi">
                <h3>Total Downloads</h3>
                <p><%= @total_downloads %></p>
            </div>
            <div class="kpi">
                <h3>Total Revenue</h3>
                <p><%= @total_revenue %></p>
            </div>
        </div>

    <h2>Top Ebooks Sold</h2>
    <table class="admin-table">
        <thead>
        <tr>
            <th>Ebook</th>
            <th>Purchases</th>
            <th>Total Revenue</th>
            <th></th>
        </tr>
        </thead>

        <tbody>
        <% @top_ebooks_sold.each do |ebook| %>
            <tr>
            <td><%= ebook.title %></td>
            <td><%= ebook.ebook_stat&.purchases_count || 0 %></td>
            <td>
                â‚¬ <%= number_with_precision(
                    ebook.ebook_stat.purchases_count * ebook.price,
                    precision: 2
                    ) %>
            </td>
            <td><%= link_to "View", ebook_path(ebook), class: "text-green-600 hover:underline" %></td>
            </tr>
        <% end %>
        </tbody>
    </table>

    <h2>Top Ebooks Viewed</h2>
    <table class="admin-table">
        <thead>
        <tr>
            <th>Ebook</th>
            <th>Views</th>
            <th>Preview Downloads</th>
            <th></th>
        </tr>
        </thead>

        <tbody>
        <% @top_ebooks_viewed.each do |ebook| %>
            <tr>
            <td><%= ebook.title %></td>
            <td><%= ebook.ebook_stat&.views_count || 0 %></td>
            <td><%= ebook.ebook_stat&.downloads_count || 0 %></td>
            <td><%= link_to "View", ebook_path(ebook), class: "text-green-600 hover:underline" %></td>
            </tr>
        <% end %>
        </tbody>
    </table>
    </div>
</div>